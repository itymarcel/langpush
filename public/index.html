<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"><title>langpush</title>
    <link rel="manifest" href="/manifest.webmanifest">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="/icon-192.png">
    <meta name="theme-color" content="#ffffff">
</head>
<body>
  <button style="font-size:larger" id="sub">Get Daily Italian <> English Phrases xx</button>
  <script>
    async function main() {
    const reg = await navigator.serviceWorker.register("/sw.js");
    const key = await (await fetch("/vapidPublicKey")).text();
    document.getElementById("sub").onclick = async () => {
        const sub = await reg.pushManager.subscribe({
            userVisibleOnly: true,
            applicationServerKey: urlBase64ToUint8Array(key)
        });
        await fetch("/subscribe", {
            method:"POST", headers:{"Content-Type":"application/json"},
            body: JSON.stringify(sub)
        });
        alert("Subscribed!");
    };
    }
    function urlBase64ToUint8Array(base64String) {
    const padding = '='.repeat((4 - base64String.length % 4) % 4);
    const base64 = (base64String + padding).replace(/-/g, '+').replace(/_/g, '/');
    const rawData = atob(base64);
    return Uint8Array.from([...rawData].map(c => c.charCodeAt(0)));
    }
    main();
  </script>
</body>
</html>
